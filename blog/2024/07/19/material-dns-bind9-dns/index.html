
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="How to install, maintain, and run a BIND9 DNS server.">
      
      
      
        <link rel="canonical" href="https://straysheep-dev.github.io/blog/2024/07/19/material-dns-bind9-dns/">
      
      
        <link rel="prev" href="../material-powershell-get-started-with-powerstig/">
      
      
        <link rel="next" href="../../../08/13/material-server-security-wazuh-all-your-things-with-tailscale/">
      
      
        
      
      
      <link rel="icon" href="../../../../../assets/favicon.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>BIND9 DNS - straysheep.dev</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  
<meta property="og:type" content="website" />
<meta property="og:title" content="BIND9 DNS - straysheep.dev" />
<meta property="og:description" content="How to install, maintain, and run a BIND9 DNS server." />
<meta property="og:image" content="https://straysheep-dev.github.io/assets/images/social/blog/2024/07/19/material-dns-bind9-dns.png" />
<meta property="og:image:type" content="image/png" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:url" content="https://straysheep-dev.github.io/blog/2024/07/19/material-dns-bind9-dns/" />
<meta property="twitter:card" content="summary_large_image" />
<meta property="twitter:title" content="BIND9 DNS - straysheep.dev" />
<meta property="twitter:description" content="How to install, maintain, and run a BIND9 DNS server." />
<meta property="twitter:image" content="https://straysheep-dev.github.io/assets/images/social/blog/2024/07/19/material-dns-bind9-dns.png" />
</head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-orange" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#bind9-dns" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="straysheep.dev" class="md-header__button md-logo" aria-label="straysheep.dev" data-md-component="logo">
      
  <img src="../../../../../assets/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            straysheep.dev
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              BIND9 DNS
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="deep-orange" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/straysheep-dev/straysheep-dev.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    straysheep-dev.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../.." class="md-tabs__link">
        
  
  
    
  
  Main

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../license/" class="md-tabs__link">
        
  
  
    
  
  License

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../../" class="md-tabs__link">
          
  
  
    
  
  Blog

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="straysheep.dev" class="md-nav__button md-logo" aria-label="straysheep.dev" data-md-component="logo">
      
  <img src="../../../../../assets/logo.svg" alt="logo">

    </a>
    straysheep.dev
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/straysheep-dev/straysheep-dev.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    straysheep-dev.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Main
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../license/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    License
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Blog
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../2019/07/15/-resources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ‚≠ê Resources
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../05/15/octicons-alert-16-aide-advanced-intrusion-detection-environment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AIDE (Advanced Intrusion Detection Environment)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../2023/08/20/simple-ansible-ansible/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ansible
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../2025/07/25/simple-ansible-ansible-molecule/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ansible Molecule
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../12/octicons-beaker-16-atomic-red-team-x-unix-artifacts-collector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Atomic Red Team x Unix Artifacts Collector
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    BIND9 DNS
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    BIND9 DNS
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#install" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#uninstall" class="md-nav__link">
    <span class="md-ellipsis">
      
        Uninstall
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initial-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Initial Setup
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#firewall" class="md-nav__link">
    <span class="md-ellipsis">
      
        Firewall
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#namedconf" class="md-nav__link">
    <span class="md-ellipsis">
      
        named.conf
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="named.conf">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dnssec" class="md-nav__link">
    <span class="md-ellipsis">
      
        DNSSEC
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-control" class="md-nav__link">
    <span class="md-ellipsis">
      
        Access Control
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logging" class="md-nav__link">
    <span class="md-ellipsis">
      
        Logging
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dnstap" class="md-nav__link">
    <span class="md-ellipsis">
      
        dnstap
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dns-over-tls" class="md-nav__link">
    <span class="md-ellipsis">
      
        DNS over TLS
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#systemd-service" class="md-nav__link">
    <span class="md-ellipsis">
      
        Systemd Service
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Systemd Service">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environment-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        Environment File
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#apparmor" class="md-nav__link">
    <span class="md-ellipsis">
      
        AppArmor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#selinux" class="md-nav__link">
    <span class="md-ellipsis">
      
        SELinux
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chroot-and-setuid" class="md-nav__link">
    <span class="md-ellipsis">
      
        chroot and setuid
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#administration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Administration
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../05/02/simple-bitwarden-bitwarden/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    bitwarden
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../05/15/material-file-tree-triage-auditd-logs-with-check-auditd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Triage auditd logs with check-auditd
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../2025/01/20/fontawesome-solid-gears-cicd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CI/CD
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../2025/06/04/material-clipboard-flow-clipboard-snooping-x11-and-wayland/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Clipboard Snooping (X11 and Wayland)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../2025/06/15/fontawesome-solid-square-binary-compile-static-binaries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Compile Static Binaries
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../05/29/octicons-terminal-16-custom-shell-profiles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Custom Shell Profiles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../05/07/simple-flatpak-flatpak/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    flatpak
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../12/08/simple-qemu-kvm-kernel-based-virtual-machine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    KVM (Kernel-based Virtual Machine)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../12/28/material-code-tags-check-linting-code/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linting Code
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../2022/08/29/material-magnify-scan-nessus/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Nessus
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../2025/04/18/material-console-network-network-commands/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Network Commands
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../12/01/material-wifi-alert-nzyme-x-simple-raspberrypi-raspberry-pi--simple-proxmox-proxmox--simple-tailscale-tailscale/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    nzyme x [ Raspberry Pi + Proxmox + Tailscale]
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../05/29/material-file-document-arrow-right-openscap-practical-usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OpenSCAP Practical Usage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../05/07/simple-openwrt-openwrt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OpenWrt
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../05/02/simple-pfsense-pfsense-administration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    pfSense administration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../material-powershell-get-started-with-powerstig/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Get Started with PowerSTIG
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../08/13/simple-proxmox-proxmox/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Proxmox
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../2025/02/22/material-sync-circle-rsync/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    rsync
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../05/07/simple-snapcraft-snap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    snap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../08/13/material-server-security-wazuh-all-your-things-with-tailscale/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Wazuh all your things with Tailscale
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../2025/10/16/material-wifi-cog-wifichallenge-exam--course-review/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    WiFiChallenge Exam &amp; Course Review
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../05/08/material-microsoft-windows-windows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Windows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_30" >
        
          
          <label class="md-nav__link" for="__nav_3_30" id="__nav_3_30_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Archive
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_30_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_30">
            <span class="md-nav__icon md-icon"></span>
            
  
    Archive
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2024
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2023
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2022/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2022
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2019/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2019
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../../../../" class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
                  <span class="md-ellipsis">
                    Back to index
                  </span>
                </a>
              </div>
            </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    Metadata
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"/></svg>
                        <time datetime="2024-07-19 00:00:00+00:00" class="md-ellipsis">July 19, 2024</time>
                      </div>
                    </li>
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15 13h1.5v2.82l2.44 1.41-.75 1.3L15 16.69zm4-5H5v11h4.67c-.43-.91-.67-1.93-.67-3a7 7 0 0 1 7-7c1.07 0 2.09.24 3 .67zM5 21a2 2 0 0 1-2-2V5c0-1.11.89-2 2-2h1V1h2v2h8V1h2v2h1a2 2 0 0 1 2 2v6.1c1.24 1.26 2 2.99 2 4.9a7 7 0 0 1-7 7c-1.91 0-3.64-.76-4.9-2zm11-9.85A4.85 4.85 0 0 0 11.15 16c0 2.68 2.17 4.85 4.85 4.85A4.85 4.85 0 0 0 20.85 16c0-2.68-2.17-4.85-4.85-4.85"/></svg>
                          <time datetime="2025-06-15 00:00:00+00:00" class="md-ellipsis">June 15, 2025</time>
                        </div>
                      </li>
                    
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"/></svg>
                          <span class="md-ellipsis">
                            
                              20 min read
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
            
          </nav>
          
            

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#install" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#uninstall" class="md-nav__link">
    <span class="md-ellipsis">
      
        Uninstall
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initial-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Initial Setup
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#firewall" class="md-nav__link">
    <span class="md-ellipsis">
      
        Firewall
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#namedconf" class="md-nav__link">
    <span class="md-ellipsis">
      
        named.conf
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="named.conf">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dnssec" class="md-nav__link">
    <span class="md-ellipsis">
      
        DNSSEC
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-control" class="md-nav__link">
    <span class="md-ellipsis">
      
        Access Control
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logging" class="md-nav__link">
    <span class="md-ellipsis">
      
        Logging
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dnstap" class="md-nav__link">
    <span class="md-ellipsis">
      
        dnstap
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dns-over-tls" class="md-nav__link">
    <span class="md-ellipsis">
      
        DNS over TLS
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#systemd-service" class="md-nav__link">
    <span class="md-ellipsis">
      
        Systemd Service
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Systemd Service">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environment-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        Environment File
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#apparmor" class="md-nav__link">
    <span class="md-ellipsis">
      
        AppArmor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#selinux" class="md-nav__link">
    <span class="md-ellipsis">
      
        SELinux
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chroot-and-setuid" class="md-nav__link">
    <span class="md-ellipsis">
      
        chroot and setuid
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#administration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Administration
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  



  
  


<h1 id="bind9-dns"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 9a2 2 0 0 1-2-2 2 2 0 0 1 2-2 2 2 0 0 1 2 2 2 2 0 0 1-2 2m13-6H4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1M7 19a2 2 0 0 1-2-2 2 2 0 0 1 2-2 2 2 0 0 1 2 2 2 2 0 0 1-2 2m13-6H4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1v-6a1 1 0 0 0-1-1"/></svg></span> BIND9 DNS</h1>
<p>How to install, maintain, and run a BIND9 DNS server (<code>named</code>). Covers building from source, configuring, hardening, and DNS over TLS as well as DNSSEC.</p>
<!-- more -->

<blockquote>
<p>BIND (Berkeley Internet Name Domain) is a complete, highly portable implementation of the Domain Name System (DNS) protocol.</p>
</blockquote>
<ul>
<li><a href="https://www.isc.org/bind/">Website</a></li>
<li><a href="https://gitlab.isc.org/isc-projects/bind9">Git</a></li>
<li><a href="https://kb.isc.org/docs/using-this-knowledgebase">ISC BIND9 Knowledge Base</a></li>
<li><a href="https://bind9.readthedocs.io/en/latest/index.html">Administrator Reference Manual</a></li>
</ul>
<p>In a few cases, to have a better understanding of what's required when managing and working with <code>bind</code> / <code>named</code>, the documentation is spread across various platforms and git issue trackers; each with their own subtle differences. This guide tries to put some of that together in a useful sequence. Both Ubuntu and Fedora are touched on in each section, but this is primarily written from the perspective of building bind from scratch, without any pre-existing binaries, service files, mandatory access controls, or configurations, and installing it on Ubuntu.</p>
<h2 id="install">Install</h2>
<p><a href="https://kb.isc.org/docs/aa-00648">BIND9  Documentation: Installing and upgrading BIND</a></p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:3"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><input id="__tabbed_1_3" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Ubuntu</label><label for="__tabbed_1_2">Fedora</label><label for="__tabbed_1_3">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Ensure your firewall is configured (the defaults <strong>will</strong> allow external DNS access).</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>ufw<span class="w"> </span>status<span class="w"> </span>verbose
sudo<span class="w"> </span>iptables<span class="w"> </span>-S
sudo<span class="w"> </span>ip6tables<span class="w"> </span>-S
</code></pre></div>
<p>Installing through <code>apt</code> preconfigures everything, the systemd service file, <del>chroot</del>, and apparmor.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="p">;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>bind9

<span class="c1"># Stop, disable systemd-resolved</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>disable<span class="w"> </span>systemd-resolved.service
sudo<span class="w"> </span>systemctl<span class="w"> </span>stop<span class="w"> </span>systemd-resolved.service

<span class="c1"># Start, enable bind</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span><span class="nb">bind</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span><span class="nb">bind</span>

<span class="c1"># Confirm apparmor confinement</span>
sudo<span class="w"> </span>aa-status<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>named

<span class="c1"># Dump version information</span>
/usr/sbin/named<span class="w"> </span>-V
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Ensure your firewall is configured (the defaults won't allow external DNS access).</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--list-all
</code></pre></div>
<p>Installing through <code>dnf</code> preconfigures everything, the systemd service file, chroot, and selinux.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="nb">bind</span>

<span class="c1"># Stop, disable systemd-resolved</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>disable<span class="w"> </span>systemd-resolved.service
sudo<span class="w"> </span>systemctl<span class="w"> </span>stop<span class="w"> </span>systemd-resolved.service

<span class="c1"># Start, enable named</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>named
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>named

<span class="c1"># Confirm selinux status</span>
getsebool<span class="w"> </span>-a<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>named

<span class="c1"># Dump version information</span>
/usr/sbin/named<span class="w"> </span>-V
</code></pre></div>
</div>
<div class="tabbed-block">
<p>When cloning the source from git, instructions for building BIND9 are located under <a href="https://gitlab.isc.org/isc-projects/bind9/-/blob/main/doc/arm/build.inc.rst">main/doc/arm/build.inc.rst</a>.</p>
<p>You have <a href="https://kb.isc.org/docs/aa-00648#bind-is-built-so-now-what">a few options when building to install or upgrade BIND9</a>:</p>
<ul>
<li>Running the new binaries from their new paths based on <code>--prefix=/usr/local</code> (difficult, system-wide changes)</li>
<li>Script replacing the existing binaries with new versions (stop <code>named</code>, replace / upgrade, restart <code>named</code>)</li>
<li><strong>Recommended</strong>: Symlink the to the new <code>bin/</code> and <code>sbin/</code> paths (good for version changes and testing)</li>
</ul>
<p>For other features available when building, a small txt report is printed to screen after the build completes. Some essentials might include DNSSEC support through the openssl development package. Same for improved performance with the jemalloc development package.</p>
<p>Install the required packages.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Install required dev packages (ubuntu)</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>make<span class="w"> </span>autoconf<span class="w"> </span>automake<span class="w"> </span>libtool<span class="w"> </span>libuv1-dev<span class="w"> </span>libcap-dev<span class="w"> </span>libssl-dev<span class="w"> </span>libxml2-dev<span class="w"> </span>libjson-c-dev<span class="w"> </span>libjemalloc-dev<span class="w"> </span>libnghttp2-dev<span class="w"> </span>liburcu-dev<span class="w"> </span>dns-root-data

<span class="c1"># Install required dev packages (fedora)</span>
sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>autoconf<span class="w"> </span>automake<span class="w"> </span>libtool<span class="w"> </span>libuv-devel<span class="w"> </span>libcap-devel<span class="w"> </span>openssl-devel<span class="w"> </span>libxml2-devel<span class="w"> </span>json-c-devel<span class="w"> </span>jemalloc-devel<span class="w"> </span>libnghttp2-devel<span class="w"> </span>userspace-rcu-devel
</code></pre></div>
<p>Clone the source, checkout a specific version.</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>~/src
<span class="nb">cd</span><span class="w"> </span>~/src
git<span class="w"> </span>clone<span class="w"> </span>https://gitlab.isc.org/isc-projects/bind9.git
<span class="nb">cd</span><span class="w"> </span>bind9
git<span class="w"> </span>tag<span class="w">               </span><span class="c1"># choose a version tag</span>
<span class="nv">version</span><span class="o">=</span><span class="s1">&#39;stable&#39;</span><span class="w">      </span><span class="c1"># leave off the &#39;v&#39; if using a numbered version</span>
git<span class="w"> </span>checkout<span class="w"> </span><span class="nv">$version</span><span class="w"> </span><span class="c1"># prepend the &#39;v&#39; if using a numbered version</span>
</code></pre></div>
<p>Build and <code>make install</code> using a unique local prefix path. This way you can build and maintain different versions.</p>
<div class="admonition quote">
<p class="admonition-title">Build Options</p>
<p>The option <code>--sysconfdir</code> can be specified to set the directory where configuration files such as <a href="https://bind9.readthedocs.io/en/stable/manpages.html#std-iscman-named.conf"><code>named.conf</code></a> go by default; <code>--localstatedir</code> can be used to set the default parent directory of <code>run/named.pid</code>. <code>--sysconfdir</code> defaults to <code>$prefix/etc</code> and <code>--localstatedir</code> defaults to <code>$prefix/var</code>.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Build Options Continued</p>
<p>Basically, on Ubuntu we can use <code>--sysconfdir=/etc/bind --localstatedir='/var'</code>, since <code>/var/run</code> is a symlink to <code>/run</code>.</p>
<p>It's entirely up to you if you would like to create and use <code>/etc/named/</code> for the conf files, you'll need to be sure to change this in your AppArmor profile.</p>
</div>
<div class="highlight"><pre><span></span><code>autoreconf<span class="w"> </span>-fi<span class="w">  </span><span class="c1"># (only if building from the git repository)</span>

<span class="c1"># Useful for in-place upgrades and new installs</span>
<span class="nv">version</span><span class="o">=</span><span class="s1">&#39;stable&#39;</span>
./configure<span class="w"> </span>--prefix<span class="o">=</span>/usr/local/bind-<span class="nv">$version</span><span class="w"> </span>--sysconfdir<span class="o">=</span>/etc/bind<span class="w"> </span>--localstatedir<span class="o">=</span><span class="s1">&#39;/var&#39;</span>

make
sudo<span class="w"> </span>make<span class="w"> </span>install
</code></pre></div>
<p>To illustrate how <code>--sysconfdir</code> and <code>--localstatedir</code> affect bind, we can run <code>named -V</code>.</p>
<div class="highlight"><pre><span></span><code>default<span class="w"> </span>paths:
named<span class="w"> </span>configuration:<span class="w">  </span>/etc/bind/named.conf<span class="w">          </span><span class="c1"># --sysconfdir=/etc/bind</span>
rndc<span class="w"> </span>configuration:<span class="w">   </span>/etc/bind/rndc.conf<span class="w">           </span><span class="c1"># --sysconfdir=/etc/bind</span>
DNSSEC<span class="w"> </span>root<span class="w"> </span>key:<span class="w">      </span>/etc/bind/bind.keys<span class="w">           </span><span class="c1"># --sysconfdir=/etc/bind</span>
nsupdate<span class="w"> </span>session<span class="w"> </span>key:<span class="w"> </span>/var/run/named/session.key<span class="w">    </span><span class="c1"># --localstatedir=/var</span>
named<span class="w"> </span>PID<span class="w"> </span>file:<span class="w">       </span>/var/run/named/named.pid<span class="w">      </span><span class="c1"># --localstatedir=/var</span>
named<span class="w"> </span>lock<span class="w"> </span>file:<span class="w">      </span>/var/run/named/named.lock<span class="w">     </span><span class="c1"># --localstatedir=/var</span>
</code></pre></div>
<p><strong>Optional</strong>: Backup any existing, currently installed binaries.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Backup existing binaries from package manager</span>
mkdir<span class="w"> </span>/usr/local/bind-pkg-mgr/<span class="o">{</span>bin,sbin,lib<span class="o">}</span><span class="w"> </span>-p
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span>/usr/local/bind-<span class="nv">$version</span>/sbin/*<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>cp<span class="w"> </span>/usr/sbin/<span class="k">$(</span>basename<span class="w"> </span><span class="nv">$i</span><span class="k">)</span><span class="w"> </span>/usr/local/bind-pkg-mgr/sbin/<span class="p">;</span><span class="w"> </span><span class="k">done</span>
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span>/usr/local/bind-<span class="nv">$version</span>/bin/*<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>cp<span class="w"> </span>/usr/bin/<span class="k">$(</span>basename<span class="w"> </span><span class="nv">$i</span><span class="k">)</span><span class="w"> </span>/usr/local/bind-pkg-mgr/bin/<span class="p">;</span><span class="w"> </span><span class="k">done</span>
sudo<span class="w"> </span>cp<span class="w"> </span>-r<span class="w"> </span>/usr/lib/named/*<span class="w"> </span>/usr/local/bind-pkg-mgr/lib/
</code></pre></div>
<p><a href="https://kb.isc.org/docs/aa-00648#bind-is-built-so-now-what">Create symlinks to the new binaries to "install" them</a>.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Symlink to new binaries compiled from source</span>
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span>/usr/local/bind-<span class="nv">$version</span>/sbin/*<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>sudo<span class="w"> </span>ln<span class="w"> </span>-f<span class="w"> </span>-s<span class="w"> </span><span class="nv">$i</span><span class="w"> </span>/usr/sbin<span class="p">;</span><span class="w"> </span><span class="k">done</span>
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span>/usr/local/bind-<span class="nv">$version</span>/bin/*<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>sudo<span class="w"> </span>ln<span class="w"> </span>-f<span class="w"> </span>-s<span class="w"> </span><span class="nv">$i</span><span class="w"> </span>/usr/bin<span class="p">;</span><span class="w"> </span><span class="k">done</span>
sudo<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/usr/lib/named
sudo<span class="w"> </span>ln<span class="w"> </span>-f<span class="w"> </span>-s<span class="w"> </span>/usr/local/bind-<span class="nv">$version</span>/lib<span class="w"> </span>/usr/lib/named
</code></pre></div>
<p>You will also need to manually create everything the prebuilt package typically installs if you're not updating an existing bind service:</p>
<ul>
<li><code>bind</code> (Ubuntu) /<code>named</code> (Fedora) user &amp; group, it's up to you to choose which, it doesn't matter</li>
<li>Configuration files and folders, (chroot) paths</li>
<li>Systemd service files</li>
<li>AppArmor / SELinux policy</li>
</ul>
<p>All of this is covered below.</p>
</div>
</div>
</div>
<h2 id="uninstall">Uninstall</h2>
<p>Follow these steps to uninstall and remove the built <code>named</code> binaries, for instance if you want to rebuild them with different configuration arguments.</p>
<p>Stop <code>named</code> if it's running.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span>stop<span class="w"> </span>named
</code></pre></div>
<p>Remove the built binaries from the prefix path.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>make<span class="w"> </span>uninstall
</code></pre></div>
<p>Remove any symlinks.</p>
<div class="highlight"><pre><span></span><code><span class="nv">version</span><span class="o">=</span><span class="s1">&#39;stable&#39;</span>
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span>/usr/local/bind-<span class="nv">$version</span>/sbin/*<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span>/usr/sbin/<span class="k">$(</span>basename<span class="w"> </span><span class="nv">$i</span><span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">done</span>
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span>/usr/local/bind-<span class="nv">$version</span>/bin/*<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span>/usr/sbin/<span class="k">$(</span>basename<span class="w"> </span><span class="nv">$i</span><span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">done</span>
sudo<span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span>/usr/lib/named
</code></pre></div>
<p>Restore the original binaries.</p>
<div class="highlight"><pre><span></span><code><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span>/usr/local/bind-pkg-mgr/sbin/*<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span>/usr/sbin/<span class="k">$(</span>basename<span class="w"> </span><span class="nv">$i</span><span class="k">)</span><span class="p">;</span><span class="w"> </span>cp<span class="w"> </span>-f<span class="w"> </span><span class="nv">$i</span><span class="w"> </span>/usr/sbin/<span class="p">;</span><span class="w"> </span><span class="k">done</span>
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span>/usr/local/bind-pkg-mgr/bin/*<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span>/usr/bin/<span class="k">$(</span>basename<span class="w"> </span><span class="nv">$i</span><span class="k">)</span><span class="p">;</span><span class="w"> </span>cp<span class="w"> </span>-f<span class="w"> </span><span class="nv">$i</span><span class="w"> </span>/usr/bin/<span class="p">;</span><span class="w"> </span><span class="k">done</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>/usr/lib/named
sudo<span class="w"> </span>cp<span class="w"> </span>-r<span class="w"> </span>/usr/local/bind-pkg-mgr/lib/*<span class="w"> </span>/usr/lib/named/
</code></pre></div>
<p><strong>Optional</strong>: Clean the project directory.</p>
<div class="highlight"><pre><span></span><code>make<span class="w"> </span>clean
</code></pre></div>
<h2 id="initial-setup">Initial Setup</h2>
<p>To ensure bind9's <code>named</code> service is working out of the box after a fresh install:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:3"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><input id="__tabbed_2_3" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Ubuntu</label><label for="__tabbed_2_2">Fedora</label><label for="__tabbed_2_3">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Point your system to <code>bind</code>'s service on localhost.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span>/etc/resolv.conf
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;nameserver 127.0.0.1&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/resolv.conf
</code></pre></div>
<p>If name resolution isn't working, and you see <code>RRSIG validity period has not begun resolving './DS/IN'</code>errors in <code>journalctl -u named</code>, ensure the date / time is correct.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>systemd-timesyncd
sudo<span class="w"> </span>date<span class="w"> </span>--set<span class="o">=</span><span class="s2">&quot;2024-01-31 12:00:00 PM PDT&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Point your system to <code>bind</code>'s service on localhost.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span>/etc/resolv.conf
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;nameserver 127.0.0.1&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/resolv.conf
</code></pre></div>
<p>If name resolution isn't working, and you see <code>RRSIG validity period has not begun resolving './DS/IN'</code>errors in <code>journalctl -u named</code>, ensure the date / time is correct.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>chronyd
sudo<span class="w"> </span>date<span class="w"> </span>--set<span class="o">=</span><span class="s2">&quot;2024-01-31 12:00:00 PM PDT&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Add a user and group. If you built from source, it's your choice whether to pick <code>named</code> or <code>bind</code>.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Ubuntu default (not required)</span>
sudo<span class="w"> </span>groupadd<span class="w"> </span><span class="nb">bind</span>
sudo<span class="w"> </span>useradd<span class="w"> </span>-g<span class="w"> </span><span class="nb">bind</span><span class="w"> </span>--system<span class="w"> </span>-M<span class="w"> </span>-s<span class="w"> </span>/usr/sbin/nologin<span class="w"> </span><span class="nb">bind</span>

<span class="c1"># Fedora default (best for compatability)</span>
sudo<span class="w"> </span>groupadd<span class="w"> </span>named
sudo<span class="w"> </span>useradd<span class="w"> </span>-g<span class="w"> </span>named<span class="w"> </span>--system<span class="w"> </span>-M<span class="w"> </span>-s<span class="w"> </span>/usr/sbin/nologin<span class="w"> </span>named
</code></pre></div>
</div>
</div>
</div>
<h2 id="firewall">Firewall</h2>
<p><code>named</code> listens on 53/udp and 53/tcp as well as 953/tcp.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">Ubuntu</label><label for="__tabbed_3_2">Fedora</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1"># By application name</span>
sudo<span class="w"> </span>ufw<span class="w"> </span>allow<span class="w"> </span>bind9

<span class="c1"># Defined ports and protocols</span>
sudo<span class="w"> </span>ufw<span class="w"> </span>allow<span class="w"> </span><span class="k">in</span><span class="w"> </span>on<span class="w"> </span>eth0<span class="w"> </span>to<span class="w"> </span>any<span class="w"> </span>port<span class="w"> </span><span class="m">53</span><span class="w"> </span>comment<span class="w"> </span><span class="s1">&#39;bind9&#39;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--add-service<span class="w"> </span>dns<span class="w"> </span>--permanent
sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--reload
</code></pre></div>
</div>
</div>
</div>
<h2 id="namedconf">named.conf</h2>
<p>BIND9 is highly configurable. The options and deployments possible are kind of overwhelming, if you're more used to something like <code>unbound</code> or especially if you've stuck with <code>systemd-resolved</code>. This section shows the bare minimum required files to get <code>named</code> running as a fully functioning DNS service.</p>
<ul>
<li><a href="https://bind9.readthedocs.io/en/stable/reference.html">BIND9  Documentation: Configuration File Reference</a></li>
<li><a href="https://kb.isc.org/docs/aa-00704">ISC KB: How to check the default option values in named.conf</a></li>
<li><a href="https://git.launchpad.net/ubuntu/+source/bind9/tree/debian/extras/etc?h=ubuntu/jammy-devel">Ubuntu Source: bind /etc Files</a></li>
<li><a href="https://src.fedoraproject.org/rpms/bind/blob/rawhide/f/named.conf.sample">Fedora Source: named.conf.sample</a></li>
</ul>
<div class="admonition tip">
<p class="admonition-title"><code>named-checkconf</code> and <code>-C</code></p>
<p>Similar to <code>unbound-checkconf</code> bind also has a tool called <code>named-checkconf</code> to validate the configuration file(s).</p>
<p><code>named</code> also has <code>named -C</code> to dump a complete example of the default option values for <code>named.conf</code>.</p>
</div>
<p>Create the directories for bind's <a href="https://bind9.readthedocs.io/en/stable/reference.html#namedconf-statement-directory">working paths</a> you define in In <code>named.conf</code>. This also depends on what you choose for <code>--localstatedir="...</code> during the build process. Remember that <code>/var/run</code> symlinks to <code>/run</code>so we need to make the following paths.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Assumes these are in named.conf, and everything else defined is within &quot;/var/cache/named&quot;</span>
<span class="c1">#   pid-file &quot;/run/named/named.pid&quot;;</span>
<span class="c1">#   directory &quot;/var/cache/named&quot;;</span>

<span class="nv">bind_paths</span><span class="o">=</span><span class="s1">&#39;/var/run/named</span>
<span class="s1">/var/cache/named&#39;</span>

<span class="k">for</span><span class="w"> </span>path<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$bind_paths</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span>sudo<span class="w"> </span>mkdir<span class="w"> </span><span class="nv">$path</span>
<span class="w">    </span>sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>bind:bind<span class="w"> </span><span class="nv">$path</span>
<span class="k">done</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Choosing an <code>/etc</code> File Path</p>
<p>As mentioned above in the <a href="#install">install</a> section about build options, this depends on what you used for <code>--sysconfdir=</code> during the build process.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>mkdir<span class="w"> </span>/etc/bind
sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>bind:bind<span class="w"> </span>/etc/bind
</code></pre></div>
</div>
<p>At minimum, we need two files to get <code>named</code> / bind running. Bind handles everything else (as of <code>BIND 9.18.26 (Extended Support Version) &lt;id:936d80b&gt;</code>).</p>
<ul>
<li><a href="https://src.fedoraproject.org/rpms/bind/blob/rawhide/f/named.conf.sample">named.conf</a></li>
<li><a href="https://src.fedoraproject.org/rpms/bind/blob/rawhide/f/named.rfc1912.zones">named.rfc1912.zones</a></li>
</ul>
<p>This is a combination of both Ubuntu and Fedora's defaults, with a few options from the BIND9 docs.</p>
<div class="highlight"><pre><span></span><code>// named.conf

options {
    pid-file &quot;/var/run/named/named.pid&quot;;

    directory          &quot;/var/cache/named&quot;;
    dump-file          &quot;/var/cache/named/data/cache_dump.db&quot;;
    statistics-file    &quot;/var/cache/named/data/named_stats.txt&quot;;
    memstatistics-file &quot;/var/cache/named/data/named_mem_stats.txt&quot;;
    secroots-file      &quot;/var/cache/named/data/named.secroots&quot;;
    recursing-file     &quot;/var/cache/named/data/named.recursing&quot;;

    listen-on port 53 { 127.0.0.1; };
    listen-on-v6 port 53 { ::1; };

    allow-query { localhost; };
    allow-query-cache { localhost; };

    recursion yes;

    dnssec-validation auto;
};

zone &quot;.&quot; IN {
    type hint;
    file &quot;/usr/share/dns/root.hints&quot;; // sudo apt install -y dns-root-data
};

include &quot;/etc/bind/named.rfc1912.zones&quot;;
</code></pre></div>
<p>Next, the rfc1912.zones file.</p>
<div class="highlight"><pre><span></span><code>// named.rfc1912.zones:
//
// Provided by Red Hat caching-nameserver package
//
// ISC BIND named zone configuration for zones recommended by
// RFC 1912 section 4.1 : localhost TLDs and address zones
// and https://tools.ietf.org/html/rfc6303
// (c)2007 R W Franks
//
// See /usr/share/doc/bind*/sample/ for example named configuration files.
//
// Note: empty-zones-enable yes; option is default.
// If private ranges should be forwarded, add
// disable-empty-zone &quot;.&quot;; into options
//

zone &quot;localhost.localdomain&quot; IN {
    type primary;
    file &quot;named.localhost&quot;;
    allow-update { none; };
};

zone &quot;localhost&quot; IN {
    type primary;
    file &quot;named.localhost&quot;;
    allow-update { none; };
};

zone &quot;1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.ip6.arpa&quot; IN {
    type primary;
    file &quot;named.loopback&quot;;
    allow-update { none; };
};

zone &quot;1.0.0.127.in-addr.arpa&quot; IN {
    type primary;
    file &quot;named.loopback&quot;;
    allow-update { none; };
};

zone &quot;0.in-addr.arpa&quot; IN {
    type primary;
    file &quot;named.empty&quot;;
    allow-update { none; };
};
</code></pre></div>
<p>At this point you can run bind as the <code>bind</code> / <code>named</code> user.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># -g runs bind in the foreground</span>
sudo<span class="w"> </span>/usr/local/bind-stable/sbin/named<span class="w"> </span>-g<span class="w"> </span>-L<span class="w"> </span>/tmp/bind.log<span class="w"> </span>-u<span class="w"> </span><span class="nb">bind</span>
</code></pre></div>
<p>You can continue on to the following sections to build your <code>named.conf</code> file(s), or skip ahead to get this running through <a href="#systemd-service">systemd</a>.</p>
<h3 id="dnssec">DNSSEC</h3>
<ul>
<li><a href="https://bind9.readthedocs.io/en/stable/chapter5.html#dnssec">BIND9  Documentation: DNSSEC</a></li>
</ul>
<p><strong>Querying</strong></p>
<p>You may have noticed <code>dnssec-validaton auto;</code> in the <code>named.conf</code> file. This tells bind to validate DNS using the built in trust anchor data (<code>bind.keys</code>) which is now just part of BIND9.</p>
<p>You can manage your own keys by setting <code>dnssec-validation yes;</code>, however keep in mind you need to manually update the key to that subdomain when it's scheduled to rotate. This is something you might do for an internal domain, or a test network.</p>
<div class="admonition quote">
<p class="admonition-title">DNSSEC History</p>
<p>The <a href="https://bind9.readthedocs.io/en/stable/dnssec-guide.html#trusted-keys-and-managed-keys">BIND9 docs suggest</a> setting this to <code>auto</code> for general use, as 90% of the top-level domains have now been signed since the root zone was signed in 2010. With the <code>bind.keys</code> data file built into the package, all of this can be handled automatically now.</p>
</div>
<p><strong>Replying</strong></p>
<p>BIND9 also has automated and manual options for <a href="https://bind9.readthedocs.io/en/stable/chapter5.html#zone-signing">Zone Signing</a>. It's recommended to make this fully automatic outside of test networks and specific use cases.</p>
<div class="admonition quote">
<p class="admonition-title">Zone Signing Example</p>
<p>To sign a zone, add the <code>dnssec-policy</code> definition to a zone block in your conf files.</p>
<div class="highlight"><pre><span></span><code>zone &quot;dnssec.example&quot; {
    type primary;
    file &quot;dnssec.example.db&quot;;
    dnssec-policy default;    ‚¨ÖÔ∏è
    inline-signing yes;
};
</code></pre></div>
<p>There are then three files created for zone keys:</p>
<ul>
<li><code>Kdnssec.example.+013+12345.private</code> private key for generating sigatures</li>
<li><code>Kdnssec.example.+013+12345.key</code> the public key for validating the signatures</li>
<li><code>Kdnssec.example+013+12345.state</code> state file used to track key timings and perform rollovers</li>
</ul>
</div>
<p>The rest of the <a href="https://bind9.readthedocs.io/en/stable/chapter5.html#dnssec">DNSSEC chapter</a> covers details like defining the DNSSEC policy parameters, and more. This guide may be updated with examples of this in the future.</p>
<h3 id="access-control">Access Control</h3>
<p><code>named</code> will listen on <em>all</em> interfaces by default on Ubuntu and only localhost (<code>::1</code>,<code>127.0.0.1</code>) on Fedora. Define ACL's to limit what resources can access the bind server.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">Ubuntu</label><label for="__tabbed_4_2">Fedora</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Define ACL's in <code>/etc/bind/named.conf.options</code>.</p>
<div class="highlight"><pre><span></span><code>acl &quot;trusted&quot; {
        ::1;
        127.0.0.1;
        10.55.55.0/24;
};

options {
        listen-on port 53 { 127.0.0.1; 10.55.55.29; };
        listen-on-v6 port 53 { ::1; 10.55.55.29; };
        allow-query     { trusted; };
        allow-recursion { trusted; };
&lt;SNIP&gt;
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Define ACL's in <code>/etc/named.conf</code>.</p>
<div class="highlight"><pre><span></span><code>acl &quot;trusted&quot; {
        ::1;
        127.0.0.1;
        10.55.55.0/24;
};

options {
        listen-on port 53 { 127.0.0.1; 10.55.55.29; };
        listen-on-v6 port 53 { ::1; 10.55.55.29; };
        allow-query     { trusted; };
        allow-recursion { trusted; };
&lt;SNIP&gt;
</code></pre></div>
</div>
</div>
</div>
<h3 id="logging">Logging</h3>
<p>The <a href="https://bind9.readthedocs.io/en/v9.19.24/reference.html#namedconf-statement-logging">logging statement</a> configures the channel (output method) and category (classes of messages) to be logged. Only one logging statement is used to define as many channels and categories as desired. If there is no logging statement, a built in default configuration is used.</p>
<p>Query logging can be enabled for <code>bind</code>/<code>named</code> with the following block.</p>
<p>First create the log file path with the correct ownership and permissions.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/var/log/named
sudo<span class="w"> </span>touch<span class="w"> </span>/var/log/named/query.log
sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>bind:bind<span class="w"> </span>/var/log/named
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">AppArmor Compatability</p>
<p>AppArmor lists the following paths for logging.</p>
<div class="highlight"><pre><span></span><code><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">named</span><span class="cm">/** rw,</span>
<span class="cm">/var/log/named/ rw,</span>
</code></pre></div>
<p>Use these, or modify the AppArmor policy to point to <code>/var/log/bind</code> instead.</p>
</div>
<p>Add or <a href="https://bind9.readthedocs.io/en/stable/reference.html#include-grammar">include</a> the following <strong>logging block</strong> in <code>named.conf</code>.</p>
<div class="highlight"><pre><span></span><code><span class="n">logging</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// https://bind9.readthedocs.io/en/latest/reference.html</span>
<span class="w">    </span><span class="c1">// The channel defines the file to send messages to</span>
<span class="w">    </span><span class="n">channel</span><span class="w"> </span><span class="n">query_channel</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">file</span><span class="w"> </span><span class="s">&quot;/var/log/bind/query.log&quot;</span><span class="w"> </span><span class="n">versions</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="mi">8</span><span class="n">m</span><span class="w"> </span><span class="n">suffix</span><span class="w"> </span><span class="n">increment</span><span class="p">;</span>
<span class="w">        </span><span class="n">print</span><span class="o">-</span><span class="n">category</span><span class="w"> </span><span class="n">yes</span><span class="p">;</span><span class="w"> </span><span class="c1">// Includes category in logs</span>
<span class="w">        </span><span class="n">print</span><span class="o">-</span><span class="n">severity</span><span class="w"> </span><span class="n">yes</span><span class="p">;</span><span class="w"> </span><span class="c1">// Includes severity in logs</span>
<span class="w">        </span><span class="n">print</span><span class="o">-</span><span class="n">time</span><span class="w"> </span><span class="n">yes</span><span class="p">;</span><span class="w"> </span><span class="c1">// Includes a timestamp in logs (iso8601 | iso8601-utc | local | &lt;boolean&gt;)</span>
<span class="w">        </span><span class="n">severity</span><span class="w"> </span><span class="n">info</span><span class="p">;</span><span class="w"> </span><span class="c1">// info is the default and lowest log level, meaning everything gets logged</span>

<span class="w">        </span><span class="c1">// Tells named to write to syslog as a specific syslog facility (your choice)</span>
<span class="w">        </span><span class="c1">// You must choose either syslog, or writing to a file, not both</span>
<span class="w">        </span><span class="c1">//syslog [&lt;syslog_facility&gt;];  // Options include daemon, syslog, kern, and many more</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="c1">// The category defines *what* is sent to the log file, there can be multiple defined</span>
<span class="w">    </span><span class="c1">// https://bind9.readthedocs.io/en/latest/reference.html#namedconf-statement-category</span>
<span class="w">    </span><span class="n">category</span><span class="w"> </span><span class="n">queries</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">query_channel</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">category</span><span class="w"> </span><span class="n">query</span><span class="o">-</span><span class="n">errors</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">query_channel</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">category</span><span class="w"> </span><span class="n">security</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">query_channel</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">category</span><span class="w"> </span><span class="n">dnssec</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">query_channel</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
<span class="p">};</span>
</code></pre></div>
<h3 id="dnstap">dnstap</h3>
<p>The <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html/managing_networking_infrastructure_services/assembly_setting-up-and-configuring-a-bind-dns-server_networking-infrastructure-services#proc_recording-dns-queries-using-dnstap_assembly_setting-up-and-configuring-a-bind-dns-server">RHEL 9 documentation</a> covers recording DNS queries using <code>dnstap</code>. Requires <code>bind-9.16.15-3</code> or later. This won't be covered here for now, as it isn't always available.</p>
<h3 id="dns-over-tls">DNS over TLS</h3>
<p>This section focuses on <strong>making queries</strong> over TLS, not running a server that accepts DNS over TLS</p>
<div class="admonition warning">
<p class="admonition-title">Minimum Version Requirements</p>
<p>Only certain recent versions of BIND9 (9.19+) have this capability. Interestingly the absolute latest version available did not have this feature enabled at the time of writing. You can easily test this by checking out a specific version, compiling the binaries, and running <code>named-checkconf</code> to assess the example blocks below. If it throws an error, DNS over TLS isn't supported in that build.</p>
<ul>
<li><a href="https://bind9.readthedocs.io/en/latest/reference.html#namedconf-statement-forwarders">BIND9: named.conf Forwarders</a></li>
<li><a href="https://unix.stackexchange.com/questions/735368/how-to-use-dns-over-tls-with-bind9-forwarders">How to use DNS over TLS with BIND9 Forwarders</a></li>
<li><a href="https://gitlab.isc.org/isc-projects/bind9/-/merge_requests/7199">gitlab.isc.org: merge Resolve "Forward queries via DoT"</a></li>
</ul>
<p>According to the git history, this feature will be available in versions 9.19 or later, and by default in 9.20 stable.</p>
</div>
<p><strong>Cloudflare</strong></p>
<ul>
<li><a href="https://developers.cloudflare.com/1.1.1.1/encryption/dns-over-tls/#example">View the CA used for DNS over TLS with kdig</a></li>
<li><a href="https://bind9.readthedocs.io/en/latest/reference.html#namedconf-statement-session-tickets">BIND9: tls block example</a></li>
</ul>
<p>The <a href="https://bind9.readthedocs.io/en/latest/reference.html#tls-block-grammar">tls block</a> in <code>named.conf</code> requires a .pem file for the CA related to the hostname we're using. Without this, there's no way to verify the hostname is actually who they say they are. We need to know what certificate authority to point to in the <code>tls</code> block of the configuraiton file. It's possible to view the certificate used for Cloudflare by checking the returned CN with <code>kdig</code>.</p>
<div class="highlight"><pre><span></span><code>dnf<span class="w"> </span>install<span class="w"> </span>knot-utils
kdig<span class="w"> </span>-d<span class="w"> </span>@1.1.1.1<span class="w"> </span>+tls-ca<span class="w"> </span>+tls-host<span class="o">=</span>one.one.one.one<span class="w"> </span>example.com<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>CN
</code></pre></div>
<p>Example configuration blocks:</p>
<div class="highlight"><pre><span></span><code>// https://bind9.readthedocs.io/en/latest/reference.html#tls-block-grammar
// You can define multiple tls blocks, one for every provider
tls Cloudflare {
    ca-file &quot;/etc/ssl/certs/DigiCert_Global_Root_G2.pem&quot;;
    remote-hostname &quot;one.one.one.one&quot;;
};
#tls Quad9 {
#   ca-file &quot;/etc/ssl/certs/?&quot;;
#   remote-hostname &quot;dns.quad9.net&quot;;
#};

options {
    // https://bind9.readthedocs.io/en/latest/reference.html#namedconf-statement-forwarders
    forwarders {
        1.1.1.1 port 853 tls Cloudflare;
        1.0.0.1 port 853 tls Cloudflare;
        2606:4700:4700::1111 port 853 tls Cloudflare;
        2606:4700:4700::1001 port 853 tls Cloudflare;

#       9.9.9.9 port 853 tls Quad9;
    };
};
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Quad9's CA File</p>
<p>It's unclear which (if any) of the CA files from the <code>ca-certificates</code> package will work for Quad9. The returned string is <code>CN=DigiCert TLS Hybrid ECC SHA384 2020 CA1</code> which the closest match on Fedora is <code>DigiCert_TLS_ECC_P384_Root_G5.pem</code>. However this CA doesn't work, and breaks name resolution.</p>
</div>
<h2 id="systemd-service">Systemd Service</h2>
<p>Now that we have bind functioning and configured, we can create a service file so it will run automatically.</p>
<div class="admonition warning">
<p class="admonition-title">Daemon Security</p>
<p>At this point in the guide, the only hardening feature implemented is dropping privileges from root to the <code>bind</code> / <code>named</code> user via <code>-u</code>. You'll want to implement one of the <a href="#security">security</a> options when finally using bind in a production sense.</p>
</div>
<p>Create the systemd service file. This assumes you've been following the recommendation of creating symlinks in <code>/usr/{sbin,bin}</code> to your <code>make install</code> path.</p>
<ul>
<li><code>EnvironmentFile=-$sysconfdir/default/named</code> is Ubuntu specific</li>
<li>Fedora uses <code>EnvironmentFile=-$sysconfdir/sysconfig/named</code></li>
<li>The entire block below is meant to be safe to copy and paste over the previous files for version testing</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># Change these as needed, especially if there&#39;s a chroot path (default is no chroot)</span>
<span class="nv">envfilepath</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="w"> </span><span class="c1"># Ubuntu=default, Fedora=sysconfig</span>

<span class="k">if</span><span class="w"> </span><span class="o">(</span>systemctl<span class="w"> </span>is-active<span class="w"> </span>named<span class="o">)</span><span class="p">;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>stop<span class="w"> </span>named<span class="p">;</span><span class="w"> </span><span class="k">fi</span>

sleep<span class="w"> </span><span class="m">3</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[Unit]</span>
<span class="s2">Description=BIND Domain Name Server</span>
<span class="s2">Documentation=man:named(8)</span>
<span class="s2">After=network.target</span>
<span class="s2">Wants=nss-lookup.target</span>
<span class="s2">Before=nss-lookup.target</span>

<span class="s2">[Service]</span>
<span class="s2">Type=forking</span>
<span class="s2">EnvironmentFile=-/etc/</span><span class="nv">$envfilepath</span><span class="s2">/named</span>
<span class="s2">ExecStart=/usr/sbin/named \$OPTIONS</span>
<span class="s2">ExecReload=/usr/sbin/rndc reload</span>
<span class="s2">ExecStop=/usr/sbin/rndc stop</span>
<span class="s2">Restart=on-failure</span>

<span class="s2">[Install]</span>
<span class="s2">WantedBy=multi-user.target</span>
<span class="s2">Alias=bind9.service&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/lib/systemd/system/named.service

sudo<span class="w"> </span>mkdir<span class="w"> </span>/etc/default
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;# run resolvconf?</span>
<span class="s1">RESOLVCONF=no</span>

<span class="s1"># startup options for the server</span>
<span class="s1">OPTIONS=&quot;-u bind&quot;&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/<span class="nv">$envfilepath</span>/named

sudo<span class="w"> </span>systemctl<span class="w"> </span>daemon-reload
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>named
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>named

systemctl<span class="w"> </span>status<span class="w"> </span>named

<span class="c1"># It should find these</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[*]cache Files&quot;</span>
find<span class="w"> </span>/var/cache/named<span class="w"> </span>-type<span class="w"> </span>f
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[*]--localstatedir Files&quot;</span>
find<span class="w"> </span>/var/run/named<span class="w"> </span>-type<span class="w"> </span>f
</code></pre></div>
<h3 id="environment-file">Environment File</h3>
<p>The script block above created the default environment file, with only the <code>-u bind</code> option. More options can be defined here.</p>
<ul>
<li>Ubuntu: <code>/etc/default/named</code></li>
<li>Fedora: <code>/etc/sysconfig/named</code></li>
</ul>
<p><strong>IPv4 or IPv6 Only</strong></p>
<p>To run only IPv4 <em>or</em> IPv6 (meaning not both), the <code>-4</code> or <code>-6</code> arguments must be passed to <code>named</code>.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Only use IPv6</span>
<span class="nv">OPTIONS</span><span class="o">=</span><span class="s2">&quot;-u bind -6&quot;</span>
</code></pre></div>
<h2 id="security">Security</h2>
<p>Hardening the bind9 / <code>named</code> process itself (meaning outside of its runtime configuration) can take one of three approaches; AppArmor, SELinux, or chroot.</p>
<h3 id="apparmor">AppArmor</h3>
<p>On Debian-based systems (Ubuntu) bind9 ships <a href="https://git.launchpad.net/ubuntu/+source/bind9/tree/debian/extras/apparmor.d/usr.sbin.named?h=ubuntu/jammy-devel">an AppArmor policy</a> that's enabled by default.</p>
<p>You could obtain this policy from the debian source package.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>sed<span class="w"> </span>-i_bkup<span class="w"> </span><span class="s1">&#39;s/# deb-src/deb-src/g&#39;</span><span class="w"> </span>/etc/apt/sources.list
sudo<span class="w"> </span>apt<span class="w"> </span>update

<span class="nb">cd</span><span class="w"> </span>~/src
apt<span class="w"> </span>download<span class="w"> </span>bind9
dpkg-deb<span class="w"> </span>-x<span class="w"> </span>./bind9_1%3a9.18.24-0ubuntu0.22.04.1_amd64.deb<span class="w"> </span>bind9-deb
<span class="nb">cd</span><span class="w"> </span>bind9-deb/etc/apparmor.d/
</code></pre></div>
<p>You can also obtain a copy of the policy file directly from Ubuntu's git repo (change the Ubuntu version to match yours).</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>~/src/bind9<span class="w">  </span><span class="c1"># Change into the bind9 upstream git folder</span>
curl<span class="w"> </span>-Lf<span class="w"> </span><span class="s1">&#39;https://git.launchpad.net/ubuntu/+source/bind9/plain/debian/extras/apparmor.d/usr.sbin.named?h=ubuntu/jammy-devel&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>usr.sbin.named
</code></pre></div>
<p>Create a local override so <code>named</code> can access either <code>/var/cache/{bind,named}</code>, whichever one exists. You could also manually edit <code>usr.sbin.named</code> to make this change, it's up to you.</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;# Local overrides for usr.sbin.named</span>
<span class="s1">  /var/cache/named/** lrw,</span>
<span class="s1">  /var/cache/named/ rw,&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apparmor.d/local/usr.sbin.named
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">AppArmor Includes</p>
<p>In any case, if the main <code>usr.sbin.named</code> AppArmor profile includes <code>local/usr.sbin.named</code>, you will at least need to <code>touch</code> that path to ensure it exists.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>touch<span class="w"> </span>/etc/apparmor.d/local/usr.sbin.named
</code></pre></div>
</div>
<p>Finally, install the AppArmor profile and reload both AppArmor and named to ensure everything works.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>cp<span class="w"> </span>./usr.sbin.named<span class="w"> </span>/etc/apparmor.d/

<span class="c1"># Load the new profile into AppArmor</span>
sudo<span class="w"> </span>apparmor_parser<span class="w"> </span>-a<span class="w"> </span>/etc/apparmor.d/usr.sbin.named

<span class="c1"># Ensure everything works, use `journalctl -xeu named` to diagnose any errors</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>named
systemctl<span class="w"> </span>status<span class="w"> </span>named<span class="w">  </span><span class="c1"># Should have no errors</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[*]AppArmor Status&quot;</span>
sudo<span class="w"> </span>aa-status<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>named
</code></pre></div>
<p>To disable the profile:</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>/etc/apparmor.d/usr.sbin.named<span class="w"> </span>/etc/apparmor.d/disable/usr.sbin.named
sudo<span class="w"> </span>apparmor_parser<span class="w"> </span>-R<span class="w"> </span>/etc/apparmor.d/usr.sbin.named
</code></pre></div>
<p>To remove the profile completely:</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apparmor_parser<span class="w"> </span>-R<span class="w"> </span>/etc/apparmor.d/usr.sbin.named
find<span class="w"> </span>/etc/apparmor.d/<span class="w"> </span>-name<span class="w"> </span><span class="s1">&#39;usr.sbin.named&#39;</span><span class="w"> </span>-print0<span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>-0<span class="w"> </span>sudo<span class="w"> </span>rm<span class="w"> </span>-f
</code></pre></div>
<p>This profile locks <code>named</code>'s ability to access or modify data to the following paths (where <code>lrw</code> means read,write,link).</p>
<div class="highlight"><pre><span></span><code>  /var/lib/bind/** rw,
  /var/lib/bind/ rw,
  /var/cache/bind/** lrw,
  /var/cache/bind/ rw,
  /var/cache/bind/_default.nzd-lock rwk,
  /var/lib/dnscvsutil/compiled/** rw,
  owner @{PROC}/@{pid}/task/@{tid}/comm rw,
  /{,var/}run/named/named.pid w,
  /{,var/}run/named/session.key w,
  /var/log/named/** rw,
  /var/log/named/ rw,
  /{,var/}run/slapd-*.socket rw,
  /var/tmp/DNS_* rw,
  /var/lib/samba/bind-dns/dns/** rwk,
  /var/lib/samba/private/dns/** rwk,
  /dev/urandom rwmk,
  owner /var/tmp/krb5_* rwk,
  /var/lib/sss/pipes/nss  rw,
  @{run}/.nscd_socket   rw,
  @{run}/nscd/socket    rw,
  @{run}/avahi-daemon/socket rw,
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Reviewing Confinement</p>
<ul>
<li><a href="https://gitlab.com/apparmor/apparmor/-/wikis/manpage_aa-exec.1#synopsis"><code>aa-exec</code> manpage</a></li>
</ul>
<p>AppArmor has a tool called <code>aa-exec</code> that allows you to run a process under the confinement of a (currently loaded) profile. When asking ChatGPT if there's a similar method for AppArmor to using <code>snap run --shell firefox</code> or <code>flatpak run --command=bash firefox</code> to explore what the snap/flatpak-confined firefox process can see and do, it pointed to <code>aa-exec</code>. This is essentially the same thing, allowing you to explore the AppArmor confinement of regular deb packages that have a profile.</p>
<p>Ensure the profile is loaded into AppAmor.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apparmor_parser<span class="w"> </span>-a<span class="w"> </span>/etc/apparmor.d/usr.sbin.named
</code></pre></div>
<p>Specify the profile name based on what <code>sudo aa-status</code> returns for that executable. For example you would use <code>named</code> and not <code>usr.sbin.named</code> here. To open a <code>bash</code> shell in <code>named</code>'s AppArmor profile:</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>aa-exec<span class="w"> </span>-p<span class="w"> </span>named<span class="w"> </span>--<span class="w"> </span>/bin/bash
</code></pre></div>
<p>This results in a bash process confined by the <code>usr.sbin.named</code> profile.</p>
<div class="highlight"><pre><span></span><code>server@ubuntu2404:~$<span class="w"> </span>sudo<span class="w"> </span>aa-exec<span class="w"> </span>-p<span class="w"> </span>named<span class="w"> </span>--<span class="w"> </span>/bin/bash
bash:<span class="w"> </span>/etc/bash.bashrc:<span class="w"> </span>Permission<span class="w"> </span>denied
bash:<span class="w"> </span>/root/.bashrc:<span class="w"> </span>Permission<span class="w"> </span>denied
bash-5.1#
bash-5.1#<span class="w"> </span>cat<span class="w"> </span>/etc/shadow
bash:<span class="w"> </span>/usr/bin/cat:<span class="w"> </span>Permission<span class="w"> </span>denied
bash-5.1#
bash-5.1#<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;bad-key&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/root/.ssh/authorized_keys
bash:<span class="w"> </span>/root/.ssh/authorized_keys:<span class="w"> </span>Permission<span class="w"> </span>denied
bash-5.1#
bash-5.1#<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span>whoami
bash:<span class="w"> </span>/usr/bin/sh:<span class="w"> </span>Permission<span class="w"> </span>denied
bash-5.1#<span class="w"> </span>bash
bash:<span class="w"> </span>/usr/bin/bash:<span class="w"> </span>Permission<span class="w"> </span>denied
bash-5.1#
bash-5.1#<span class="w"> </span>nc
bash:<span class="w"> </span>/usr/bin/nc:<span class="w"> </span>Permission<span class="w"> </span>denied
bash-5.1#
bash-5.1#<span class="w"> </span>curl<span class="w"> </span>http://127.0.0.1:8080/exploit.py<span class="w"> </span><span class="p">|</span><span class="w"> </span>python3
bash:<span class="w"> </span>/usr/bin/python3:<span class="w"> </span>Permission<span class="w"> </span>denied
bash:<span class="w"> </span>/usr/bin/curl:<span class="w"> </span>Permission<span class="w"> </span>denied
bash-5.1#
bash-5.1#<span class="w"> </span>touch<span class="w"> </span>/tmp/test.txt
bash:<span class="w"> </span>/usr/bin/touch:<span class="w"> </span>Permission<span class="w"> </span>denied
</code></pre></div>
</div>
<h3 id="selinux">SELinux</h3>
<p><em>‚ö†Ô∏è TO DO, check back later!</em></p>
<h3 id="chroot-and-setuid">chroot and setuid</h3>
<p>This option comes with a number of caveats.</p>
<div class="admonition warning">
<p class="admonition-title">Chroot vs Mandatory Access Control</p>
<p>The <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html/managing_networking_infrastructure_services/assembly_setting-up-and-configuring-a-bind-dns-server_networking-infrastructure-services#ref_considerations-about-protecting-bind-with-selinux-or-running-it-in-a-change-root_environment_assembly_setting-up-and-configuring-a-bind-dns-server">RHEL 9 documentation</a> suggests using a mandatory access control mechanism like SELinux or AppArmor is more robust than a chroot jail. Only use this method if you cannot use AppArmor of SELinux.</p>
<p>Additionally, if you want to use AppArmor on top of a chroot environment, <a href="https://wiki.ubuntu.com/DebuggingApparmor#AppArmor_and_chroot_environments">you will need to modify the AppArmor profile to use the chroot base path</a>.</p>
</div>
<div class="admonition info">
<p class="admonition-title">bind-chroot.x86_64</p>
<p>This functionality is available as an rpm package, <code>bind-chroot</code> (on Fedora) and <code>named-chroot</code> (on RHEL).</p>
<ul>
<li><a href="https://bind9.readthedocs.io/en/v9.19.24/chapter7.html#chroot-and-setuid">BIND9  Documentation: Chroot and Setuid</a></li>
<li><a href="https://help.ubuntu.com/community/BIND9ServerHowto#Chrooting_BIND9">Ubuntu Community: Chrooting BIND9</a></li>
</ul>
</div>
<div class="admonition quote">
<p class="admonition-title">The chroot environment</p>
<p>Unlike with earlier versions of BIND, <a href="https://bind9.readthedocs.io/en/v9.19.24/manpages.html#std-iscman-named">named</a> does <em>not</em> typically need to be compiled statically, nor do shared libraries need to be installed under the new root. However, depending on the operating system, it may be necessary to set up locations such as <code>/dev/zero</code>, <code>/dev/random</code>, <code>/dev/log</code>, and <code>/etc/localtime</code>.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Building on What Exists</p>
<p>The Fedora repo for bind contains a number of files you could use to script setting up a chroot instance.</p>
<ul>
<li><a href="https://src.fedoraproject.org/rpms/bind/blob/rawhide/f/named-chroot-setup.service">named-chroot-setup.service</a>, executes <code>setup-named-chroot.sh</code>, <code>After=named-setup-rndc.service</code></li>
<li><a href="https://src.fedoraproject.org/rpms/bind/blob/rawhide/f/setup-named-chroot.sh">setup-named-chroot.sh</a>, this creates the necessary directories on Fedora using <a href="https://src.fedoraproject.org/rpms/bind/blob/rawhide/f/named-chroot.files">named-chroot.files</a></li>
<li><a href="https://src.fedoraproject.org/rpms/bind/blob/rawhide/f/named-chroot.service">named-chroot.service</a>, the main service file, running <code>named</code> in a chroot environment</li>
<li><a href="https://src.fedoraproject.org/rpms/bind/blob/rawhide/f/named-setup-rndc.service">named-setup-rndc.service</a>, executes <code>generate-rndc-key.sh</code></li>
<li><a href="https://src.fedoraproject.org/rpms/bind/blob/rawhide/f/generate-rndc-key.sh">generate-rndc-key.sh</a>, generates <code>/etc/rndc.key</code> if doesn't exist AND if there is no <code>rndc.conf</code></li>
</ul>
</div>
<p>Without a kernel-based mandatory access control system, you can still chroot the <code>bind</code>/<code>named</code> process into its own "sandbox" directory, and run bind unprivileged with <code>-u &lt;user&gt;</code>.</p>
<p><strong>Setting Up the Chroot</strong></p>
<p>To do this as simply as possible on Ubuntu, start by making the chroot paths:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Add any paths you use that are missing here</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/chroot/bind/<span class="o">{</span>etc/<span class="o">{</span>bind,default<span class="o">}</span>,var/<span class="o">{</span>cache/named/data,run/named,log/bind<span class="o">}</span>,usr/share/dns<span class="o">}</span>
find<span class="w"> </span>/chroot/<span class="w"> </span>-type<span class="w"> </span>d
<span class="c1"># The bind user can only write to /chroot/bind/var, read the rest</span>
sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>root:bind<span class="w"> </span>/chroot/bind
sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>bind:bind<span class="w"> </span>/chroot/bind/var
</code></pre></div>
<p>Note that you don't need to copy any libraries or other binaries into the chroot, only files <code>named</code> will read or write to.</p>
<p>Copy the existing configuration files over.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>cp<span class="w"> </span>/etc/bind/*<span class="w"> </span>/chroot/bind/etc/bind/
sudo<span class="w"> </span>cp<span class="w"> </span>/etc/default/named<span class="w"> </span>/chroot/bind/etc/default/
sudo<span class="w"> </span>cp<span class="w"> </span>/usr/share/dns/root.hints<span class="w"> </span>/chroot/bind/usr/share/dns/
</code></pre></div>
<p>For compatability, we'll create a separate Systemd service called named-chroot.</p>
<div class="highlight"><pre><span></span><code><span class="nv">envfilepath</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="w"> </span><span class="c1"># Ubuntu=default, Fedora=sysconfig</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[Unit]</span>
<span class="s2">Description=BIND Domain Name Server (Chroot)</span>
<span class="s2">Documentation=man:named(8)</span>
<span class="s2">After=network.target</span>
<span class="s2">Wants=nss-lookup.target</span>
<span class="s2">Before=nss-lookup.target</span>

<span class="s2">[Service]</span>
<span class="s2">Type=forking</span>
<span class="s2">EnvironmentFile=-/etc/</span><span class="nv">$envfilepath</span><span class="s2">/named</span>
<span class="s2">ExecStart=/usr/sbin/named \$OPTIONS -t /chroot/bind</span>
<span class="s2">ExecReload=/usr/sbin/rndc reload</span>
<span class="s2">ExecStop=/usr/sbin/rndc stop</span>
<span class="s2">Restart=on-failure</span>

<span class="s2">[Install]</span>
<span class="s2">WantedBy=multi-user.target</span>
<span class="s2">Alias=bind9-chroot.service&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/lib/systemd/system/named-chroot.service
</code></pre></div>
<p>Stop the non-chroot service, then start the chroot service.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span>stop<span class="w"> </span>named
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>named-chroot
systemctl<span class="w"> </span>status<span class="w"> </span>named-chroot

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[*]Chroot runtime files&quot;</span>
find<span class="w"> </span>/chroot/<span class="w"> </span>-type<span class="w"> </span>f
</code></pre></div>
<p><code>named</code> is now running in a chroot.</p>
<div class="admonition example">
<p class="admonition-title">Reviewing Confinement</p>
<ul>
<li><a href="https://www.gnu.org/software/coreutils/chroot">GNU Manual: Coreutils/Chroot</a></li>
<li><a href="https://book.hacktricks.xyz/linux-hardening/privilege-escalation/escaping-from-limited-bash#chroot-escapes">HackTricks: Chroot Escapes</a></li>
</ul>
<p>You can interactively explore a chroot environment with the <code>chroot &lt;path&gt;</code> command. Specify the <code>&lt;path&gt;</code> to your chroot, then a command or shell to execute. If you don't specify a shell, it defaults to <code>/bin/sh -i</code>.</p>
<div class="admonition quote">
<p class="admonition-title">man chroot</p>
<p>If no command is given, run '"$SHELL" -i' (default: '/bin/sh -i').</p>
</div>
<p>You can see below with the chroot created for bind, there aren't any binaries available to execute. There's no way to explore this interactively in our case, which is exactly what we want. For reference, <code>find</code> was used to list all avaialble files under the chroot. Assume that a rogue <code>named</code> process could at the very least "see" these files, which is fine.</p>
<div class="highlight"><pre><span></span><code>server@ubuntu2404:~$<span class="w"> </span>sudo<span class="w"> </span>chroot<span class="w"> </span>/chroot/bind
chroot:<span class="w"> </span>failed<span class="w"> </span>to<span class="w"> </span>run<span class="w"> </span><span class="nb">command</span><span class="w"> </span>‚Äò/bin/bash‚Äô:<span class="w"> </span>No<span class="w"> </span>such<span class="w"> </span>file<span class="w"> </span>or<span class="w"> </span>directory
server@ubuntu2404:~$
server@ubuntu2404:~$<span class="w"> </span>sudo<span class="w"> </span>find<span class="w"> </span>/chroot/<span class="w"> </span>-type<span class="w"> </span>f
/chroot/bind/etc/bind/named.conf
/chroot/bind/etc/bind/rndc.key
/chroot/bind/etc/bind/named.rfc1912.zones
/chroot/bind/etc/bind/bind.keys
/chroot/bind/etc/bind/rndc.conf
/chroot/bind/usr/share/dns/root.hints
/chroot/bind/var/run/named/session.key
/chroot/bind/var/run/named/named.pid
/chroot/bind/var/cache/named/managed-keys.bind
/chroot/bind/var/cache/named/managed-keys.bind.jnl
</code></pre></div>
</div>
<h2 id="administration">Administration</h2>
<ul>
<li><a href="https://bind9.readthedocs.io/en/stable/chapter4.html#administrative-tools">BIND9 Administrative Tools</a></li>
</ul>
<p>First create an <code>rndc.key</code> file.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>rndc-confgen<span class="w"> </span>-a
</code></pre></div>
<p>This file holds the shared secret used to connect to the server, in our case localhost. You'll need to make sure <code>named</code> can read this file. If you're running as <code>-u bind</code> this means something like:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Remember to copy these into the chroot if you&#39;re using one</span>
sudo<span class="w"> </span>chown<span class="w"> </span>root:bind<span class="w"> </span>/etc/bind/rndc.key
sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">640</span><span class="w"> </span>/etc/bind/rndc.key
</code></pre></div>
<p>Then write a conf file, <a href="https://bind9.readthedocs.io/en/stable/reference.html#include-grammar">including</a> the <code>rndc.key</code> file.</p>
<div class="highlight"><pre><span></span><code>//<span class="w"> </span>https://bind9.readthedocs.io/en/stable/chapter4.html#rndcconf-statement-options
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;options {</span>
<span class="s1">    default-key rndc-key;</span>
<span class="s1">    default-port 953;</span>
<span class="s1">    default-server &quot;localhost&quot;;</span>
<span class="s1">};</span>

<span class="s1">include &quot;/etc/bind/rndc.key&quot;&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/bind/rndc.conf
</code></pre></div>
<p>Restart <code>named</code> to load the key.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>named
</code></pre></div>
<p>Diagnosing a misbehaving BIND server is detailed <a href="https://kb.isc.org/docs/aa-00341">here</a>.</p>
<div class="highlight"><pre><span></span><code>rndc<span class="w"> </span>status<span class="w">         </span><span class="c1"># Obtain a snapshot of `named`&#39;s status</span>

rndc<span class="w"> </span>recursing<span class="w">      </span><span class="c1"># Generate a list of the client queries that named is currently handling (named.recursing)</span>

rndc<span class="w"> </span>dumpdb<span class="w"> </span>-all<span class="w">    </span><span class="c1"># Get a snapshot of the current state of named&#39;s cache (named_dump.db)</span>

rndc<span class="w"> </span>querylog<span class="w">       </span><span class="c1"># Toggle query logging on</span>

rndc<span class="w"> </span>trace<span class="w"> </span><span class="m">3</span><span class="w">        </span><span class="c1"># Temporarily increase the level of server logging</span>
</code></pre></div>
<p>Follow journal message with:</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>journalctl<span class="w"> </span>-f<span class="w"> </span>-u<span class="w"> </span><span class="nb">bind</span><span class="w">  </span><span class="c1"># or named, if you used named instead</span>
</code></pre></div>
<p>Run <code>named</code> in the foreground with:</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>named<span class="w"> </span>-g<span class="w"> </span>-L<span class="w"> </span>/tmp/named.log<span class="w"> </span>-u<span class="w"> </span><span class="nb">bind</span><span class="w"> </span>-c<span class="w"> </span>/etc/bind/named.conf
</code></pre></div>







  
  




  



      
    </article>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023-2024 straysheep-dev
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/straysheep-dev" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.path", "navigation.tabs", "navigation.sections", "navigation.indexes", "navigation.path", "navigation.top", "toc.integrate", "search.suggest", "search.highlight", "search.share", "content.tooltips"], "search": "../../../../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>